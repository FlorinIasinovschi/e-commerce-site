import s from"autoprefixer";import e from"browserslist";import t from"cssdb";import o from"postcss-attribute-case-insensitive";import r from"css-blank-pseudo";import i from"postcss-color-functional-notation";import n from"postcss-color-hex-alpha";import c from"postcss-color-rebeccapurple";import p from"postcss-custom-media";import a from"postcss-custom-properties";import u from"postcss-custom-selectors";import l from"postcss-dir-pseudo-class";import m from"postcss-double-position-gradients";import f from"postcss-env-function";import d from"postcss-focus-visible";import b from"postcss-focus-within";import g from"postcss-font-variant";import y from"postcss-gap-properties";import O from"css-has-pseudo";import h from"postcss-image-set-function";import j from"postcss-initial";import v from"postcss-lab-function";import w from"postcss-logical";import k from"postcss-media-minmax";import $ from"postcss-nesting";import x from"postcss-overflow-shorthand";import S from"postcss-page-break";import P from"postcss-place";import M from"css-prefers-color-scheme";import q from"postcss-pseudo-class-any-link";import F from"postcss-replace-overflow-wrap";import T from"postcss-selector-not";import*as B from"caniuse-lite";import U from"fs";import V from"path";function A(){return{postcssPlugin:"postcss-system-ui-font",Declaration(s){E.test(s.prop)&&(s.value.includes(N.join(", "))||(s.value=s.value.replace(C,J)))}}}A.postcss=!0;const E=/(?:^(?:-|\\002d){2})|(?:^font(?:-family)?$)/i,I="[\\f\\n\\r\\x09\\x20]",N=["system-ui","-apple-system","Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans","sans-serif"],C=new RegExp(`(^|,|${I}+)(?:system-ui${I}*)(?:,${I}*(?:${N.join("|")})${I}*)?(,|$)`,"i"),J=`$1${N.join(", ")}$2`,R={"css-blank-pseudo":"blank-pseudo-class","css-has-pseudo":"has-pseudo-class","css-prefers-color-scheme":"prefers-color-scheme-query","postcss-attribute-case-insensitive":"case-insensitive-attributes","postcss-color-functional-notation":"color-functional-notation","postcss-color-hex-alpha":"hexadecimal-alpha-notation","postcss-color-rebeccapurple":"rebeccapurple-color","postcss-custom-media":"custom-media-queries","postcss-custom-properties":"custom-properties","postcss-custom-selectors":"custom-selectors","postcss-dir-pseudo-class":"dir-pseudo-class","postcss-double-position-gradients":"double-position-gradients","postcss-env-function":"environment-variables","postcss-focus-visible":"focus-visible-pseudo-class","postcss-focus-within":"focus-within-pseudo-class","postcss-font-variant":"font-variant-property","postcss-gap-properties":"gap-properties","postcss-image-set-function":"image-set-function","postcss-initial":"all-property","postcss-lab-function":"lab-function","postcss-logical":"logical-properties-and-values","postcss-media-minmax":"media-query-ranges","postcss-nesting":"nesting-rules","postcss-overflow-shorthand":"overflow-property","postcss-page-break":"break-properties","postcss-place":"place-properties","postcss-pseudo-class-any-link":"any-link-pseudo-class","postcss-replace-overflow-wrap":"overflow-wrap-property","postcss-selector-not":"not-pseudo-class","postcss-system-ui-font-family":"system-ui-font-family"},D=(()=>{const s={};for(const[e,t]of Object.entries(R))s[t]=e;return s})(),L={"all-property":j,"any-link-pseudo-class":q,"blank-pseudo-class":r,"break-properties":S,"case-insensitive-attributes":o,"color-functional-notation":i,"custom-media-queries":p,"custom-properties":a,"custom-selectors":u,"dir-pseudo-class":l,"double-position-gradients":m,"environment-variables":f,"focus-visible-pseudo-class":d,"focus-within-pseudo-class":b,"font-variant-property":g,"gap-properties":y,"has-pseudo-class":O,"hexadecimal-alpha-notation":n,"image-set-function":h,"lab-function":v,"logical-properties-and-values":w,"media-query-ranges":k,"nesting-rules":$,"not-pseudo-class":T,"overflow-property":x,"overflow-wrap-property":F,"place-properties":P,"prefers-color-scheme-query":M,"rebeccapurple-color":c,"system-ui-font-family":A};function z(s,e){return Object.keys(s).map((t=>[].concat(s[t]).map((s=>({[e]:!0,plugin:s,id:t}))))).reduce(((s,e)=>s.concat(e)),[])}function G(s){const e=B.features[s];if(e){const s=B.feature(e).stats;return Object.keys(s).reduce(((e,t)=>e.concat(Object.keys(s[t]).filter((e=>0!==s[t][e].indexOf("y"))).map((s=>`${t} ${s}`)))),[])}return["> 0%"]}var H=["custom-media-queries","custom-properties","environment-variables","image-set-function","media-query-ranges","prefers-color-scheme-query","nesting-rules","custom-selectors","any-link-pseudo-class","case-insensitive-attributes","focus-visible-pseudo-class","focus-within-pseudo-class","matches-pseudo-class","not-pseudo-class","logical-properties-and-values","dir-pseudo-class","all-property","color-functional-notation","double-position-gradients","hexadecimal-alpha-notation","lab-function","rebeccapurple-color","color-mod-function","blank-pseudo-class","break-properties","font-variant-property","has-pseudo-class","gap-properties","overflow-property","overflow-wrap-property","place-properties","system-ui-font-family"];async function K(s,e,t,o){const r=function(s){return`:root {\n${Object.keys(s).reduce(((e,t)=>(e.push(`\t${t}: ${s[t]};`),e)),[]).join("\n")}\n}\n`}(t),i=function(s){return`${Object.keys(s).reduce(((e,t)=>(e.push(`@custom-media ${t} ${s[t]};`),e)),[]).join("\n")}\n`}(e),n=function(s){return`${Object.keys(s).reduce(((e,t)=>(e.push(`@custom-selector ${t} ${s[t]};`),e)),[]).join("\n")}\n`}(o),c=`${i}\n${n}\n${r}`;await Z(s,c)}function Q(s,e){return`\n\t${s}: {\n${Object.keys(e).reduce(((s,t)=>(s.push(`\t\t'${_(t)}': '${_(e[t])}'`),s)),[]).join(",\n")}\n\t}`}function W(s,e){return`export const ${s} = {\n${Object.keys(e).reduce(((s,t)=>(s.push(`\t'${_(t)}': '${_(e[t])}'`),s)),[]).join(",\n")}\n};\n`}function X(s,e){return Promise.all([].concat(e).map((async e=>{if(e instanceof Function)await e({customMedia:Y(s.customMedia),customProperties:Y(s.customProperties),customSelectors:Y(s.customSelectors)});else{const t=e===Object(e)?e:{to:String(e)},o=t.toJSON||Y;if("customMedia"in t||"customProperties"in t||"customSelectors"in t)t.customMedia=o(s.customMedia),t.customProperties=o(s.customProperties),t.customSelectors=o(s.customSelectors);else if("custom-media"in t||"custom-properties"in t||"custom-selectors"in t)t["custom-media"]=o(s.customMedia),t["custom-properties"]=o(s.customProperties),t["custom-selectors"]=o(s.customSelectors);else{const e=String(t.to||""),r=(t.type||V.extname(t.to).slice(1)).toLowerCase(),i=o(s.customMedia),n=o(s.customProperties),c=o(s.customSelectors);"css"===r&&await K(e,i,n,c),"js"===r&&await async function(s,e,t,o){const r=`module.exports = {${Q("customMedia",e)},${Q("customProperties",t)},${Q("customSelectors",o)}\n};\n`;await Z(s,r)}(e,i,n,c),"json"===r&&await async function(s,e,t,o){const r=`${JSON.stringify({"custom-media":e,"custom-properties":t,"custom-selectors":o},null,"  ")}\n`;await Z(s,r)}(e,i,n,c),"mjs"===r&&await async function(s,e,t,o){const r=`${W("customMedia",e)}\n${W("customProperties",t)}\n${W("customSelectors",o)}`;await Z(s,r)}(e,i,n,c)}}})))}function Y(s){return Object.keys(s).reduce(((e,t)=>(e[t]=String(s[t]),e)),{})}function Z(s,e){return new Promise(((t,o)=>{U.writeFile(s,e,(s=>{s?o(s):t()}))}))}function _(s){return s.replace(/\\([\s\S])|(')/g,"\\$1$2").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function ss(s,t){const o=e(s,{ignoreUnknownVersions:!0});return"nesting-rules"===t.id&&function(s,t){const o=G(s);if(t.some((s=>e(o,{ignoreUnknownVersions:!0}).some((e=>e===s)))))return!0;return!1}("css-matches-pseudo",o)?{noIsPseudoSelector:!0}:{}}function es(s,e){let t="unknown",o=1/0;for(let r=0;r<e.length;r++){const i=ts(s,e[r]);i<o&&(o=i,t=e[r])}return{mostSimilar:t,distance:o}}function ts(s,e){if(!s.length)return e.length;if(!e.length)return s.length;const t=[];for(let o=0;o<=e.length;o++){t[o]=[o];for(let r=1;r<=s.length;r++)t[o][r]=0===o?r:Math.min(t[o-1][r]+1,t[o][r-1]+1,t[o-1][r-1]+(s[r-1]===e[o-1]?0:1))}return t[e.length][s.length]}const os=o=>{const r=Object(Object(o).features),i=Object.keys(r),n=Object(Object(o).insertBefore),c=Object(Object(o).insertAfter),p=Object(o).browsers,a="stage"in Object(o)?!1===o.stage?5:parseInt(o.stage)||0:2,u=Object(o).autoprefixer,l=rs(Object(o)),m=!1===u?()=>{}:s(Object.assign({overrideBrowserslist:p},u)),f=t.concat(z(n,"insertBefore"),z(c,"insertAfter")).filter((s=>s.insertBefore||s.id in L)).sort(((s,e)=>H.indexOf(s.id)-H.indexOf(e.id)||(s.insertBefore?-1:e.insertBefore?1:0)||(s.insertAfter?1:e.insertAfter?-1:0))).map((s=>{const e=G(s.caniuse);return s.insertBefore||s.insertAfter?{browsers:e,plugin:s.plugin,id:`${s.insertBefore?"before":"after"}-${s.id}`,stage:6}:{browsers:e,plugin:L[s.id],id:s.id,stage:s.stage}})).filter((s=>s.id in r?r[s.id]:s.stage>=a)).map((s=>{let e,t;return e=ss(p,s),e=!0===r[s.id]?l?Object.assign({},e,l):void 0:l?Object.assign({},e,l,r[s.id]):Object.assign({},e,r[s.id]),t=s.plugin.postcss?s.plugin(e):s.plugin,{browsers:s.browsers,plugin:t,pluginOptions:e,id:s.id}})),d=e(p,{ignoreUnknownVersions:!0}),b=f.filter((s=>s.id in r?r[s.id]:!!function(s){if("importFrom"in s.pluginOptions)switch(s.id){case"custom-media-queries":if(Object.keys(Object(s.pluginOptions.importFrom.customMedia)).length)return!0;break;case"custom-properties":if(Object.keys(Object(s.pluginOptions.importFrom.customProperties)).length)return!0;break;case"environment-variables":if(Object.keys(Object(s.pluginOptions.importFrom.environmentVariables)).length)return!0;break;case"custom-selectors":if(Object.keys(Object(s.pluginOptions.importFrom.customSelectors)).length)return!0}if("exportTo"in s.pluginOptions)switch(s.id){case"custom-media-queries":if(Object.keys(Object(s.pluginOptions.exportTo.customMedia)).length)return!0;break;case"custom-properties":if(Object.keys(Object(s.pluginOptions.exportTo.customProperties)).length)return!0;break;case"environment-variables":if(Object.keys(Object(s.pluginOptions.exportTo.environmentVariables)).length)return!0;break;case"custom-selectors":if(Object.keys(Object(s.pluginOptions.exportTo.customSelectors)).length)return!0}return!1}(s)||d.some((t=>e(s.browsers,{ignoreUnknownVersions:!0}).some((s=>s===t)))))).map((s=>s.plugin));b.push(m);const g=()=>({postcssPlugin:"postcss-preset-env",OnceExit:function(s,{result:e}){!function(s,e,t){const o=Object.keys(D),r=Object.keys(R);s.forEach((s=>{if(o.includes(s))return;const i=es(s,o),n=es(s,r);i.distance<n.distance?e.warn(t,`Unknown feature: "${s}" did you mean: "${i.mostSimilar}"`):e.warn(t,`Unknown feature: "${s}" did you mean: "${R[n.mostSimilar]}"`)}))}(i,s,e),Object(o).exportTo&&X(l.exportTo,o.exportTo)}});return g.postcss=!0,{postcssPlugin:"postcss-preset-env",plugins:[...b,g()]}},rs=s=>{if("importFrom"in s||"exportTo"in s||"preserve"in s){const e={};return"importFrom"in s&&(e.importFrom=s.importFrom),"exportTo"in s&&(e.exportTo={customMedia:{},customProperties:{},customSelectors:{}}),"preserve"in s&&(e.preserve=s.preserve),e}return!1};os.postcss=!0;export{os as default};
